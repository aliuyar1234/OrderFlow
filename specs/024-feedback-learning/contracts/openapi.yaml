openapi: 3.1.0
info:
  title: OrderFlow - Feedback & Learning API
  version: 1.0.0

paths:
  /sku-mappings/{id}/confirm:
    post:
      summary: Confirm SKU mapping
      description: Confirm a suggested SKU mapping, updating status to CONFIRMED and capturing feedback event
      operationId: confirmSKUMapping
      tags:
        - SKU Mappings
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Mapping confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [CONFIRMED]
        '401':
          description: Unauthorized
        '404':
          description: Mapping not found
      security:
        - bearerAuth: []

  /analytics/learning:
    get:
      summary: Get learning analytics
      description: Retrieve feedback events, layout coverage, and quality trends
      operationId: getLearningAnalytics
      tags:
        - Analytics
      parameters:
        - name: start_date
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: call_type
          in: query
          required: false
          schema:
            type: string
            enum: [MAPPING_CONFIRMED, EXTRACTION_LINE_CORRECTED]
      responses:
        '200':
          description: Analytics data
          content:
            application/json:
              schema:
                type: object
                properties:
                  events_by_day:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                        count:
                          type: integer
                  corrected_fields:
                    type: array
                    items:
                      type: object
                      properties:
                        field:
                          type: string
                        count:
                          type: integer
                  layout_stats:
                    type: array
                    items:
                      type: object
                      properties:
                        fingerprint:
                          type: string
                        seen_count:
                          type: integer
                        example_count:
                          type: integer
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - requires ADMIN or INTEGRATOR role
      security:
        - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
